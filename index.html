<!DOCTYPE html>
<html>
<head>
    <title>ar://playdead</title>

    <!-- Metadata -->
    <meta property="og:title" content="Dead For(actually)ever via ar://playdead" />
    <meta property="og:description" content="Always dead, always jamming." />
    <meta property="og:image" content="https://arweave.net/6F5j_Hb-p8YVcLgK7zgyIfteakEf4V548Q75C-6uCWs" />
    <meta property="og:url" content="https://playdead.arweave.net" />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Dead For(actually)ever via ar://playdead" />
    <meta name="twitter:description" content="Always dead, always jamming." />
    <meta name="twitter:image" content="https://arweave.net/6F5j_Hb-p8YVcLgK7zgyIfteakEf4V548Q75C-6uCWs" />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicon -->
    <link rel="icon" href="./assets/favicon.ico" type="image/x-icon">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="./assets/style.css">
</head>
<body>
    <img id="app-logo" class="logo" src="./assets/app-logo.png" alt="Steal your face">
    <h1>ar://playdead</h1>

    <div id="album-list" class="album-list">Loading...</div>

    <!-- Load Tape Section -->
    <div id="load-tape" class="manual-album-entry">
        <input id="manual-txid" type="text" placeholder="Load Tape TXID" />
        <button id="load-album-button">
            <img src="./assets/icon-cassette.png" alt="Load Tape">
        </button>
        <button id="info-button" title="Learn how to format albums" onclick="window.open('contribute.html', '_blank')">i</button>
    </div>

    <footer>
        <p><strong>ar://playdead</strong> by @JonnieSparkles and ChatGPT</p>
        <p>v2.1</p>
    </footer>

    <script>
        async function loadAlbumList() {
            const catalogUrl = "catalog.json"; // Path to the catalog JSON
            const gateway = window.location.origin; // Dynamically resolve the gateway based on the current URL

            try {
                const response = await fetch(catalogUrl);
                if (!response.ok) throw new Error(`Failed to fetch catalog.json`);
                const catalog = await response.json();

                const albumList = document.getElementById("album-list");
                albumList.innerHTML = ""; // Clear the "Loading..." text

                catalog.forEach(albumRef => {
                    // Create the album item
                    const albumItem = document.createElement("a");
                    albumItem.href = `player.html?album=${albumRef.txid}`;
                    albumItem.className = "album-item";

                    // Use default cover for all albums
                    const icon = document.createElement("img");
                    icon.src = "./assets/icon-cassette.png"; // Default album cover
                    icon.alt = "Default Album Cover";

                    const albumName = document.createElement("span");
                    albumName.textContent = `${albumRef.band || "Unknown Band"} - ${albumRef.title || "Untitled Album"}`;

                    albumItem.appendChild(icon);
                    albumItem.appendChild(albumName);
                    albumList.appendChild(albumItem);
                });
            } catch (error) {
                console.error("Error loading catalog:", error.message);
            }
        }

        document.getElementById("load-album-button").onclick = () => {
            const txid = document.getElementById("manual-txid").value.trim();
            if (txid) {
                window.location.href = `player.html?album=${txid}`;
            } else {
                alert("Please enter a valid TXID.");
            }
        };

        // Load the album list on page load
        window.onload = loadAlbumList;
    </script>
</body>
</html>
